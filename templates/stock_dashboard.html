<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aè‚¡è‚¡ç¥¨åˆ†æå¹³å°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .stock-card {
            cursor: pointer;
        }
        .stock-card:hover {
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }
        .positive {
            color: #e74c3c;
        }
        .negative {
            color: #27ae60;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        .chart-container {
            height: 300px;
            padding: 20px;
        }
        .rank-badge {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.2rem;
        }
        .rank-1 { background-color: #f1c40f; color: white; }
        .rank-2 { background-color: #95a5a6; color: white; }
        .rank-3 { background-color: #d35400; color: white; }
        .rank-other { background-color: #3498db; color: white; }
        .tab-content {
            padding: 20px 0;
        }
        .nav-tabs .nav-link {
            color: #666;
        }
        .nav-tabs .nav-link.active {
            color: #667eea;
            font-weight: bold;
        }
        .metric-card {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
        }
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s;
        }
        .refresh-btn:hover {
            transform: scale(1.1);
        }
        .refresh-btn:active {
            transform: scale(0.95);
        }
        .search-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .search-input {
            font-size: 1.2rem;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: border-color 0.3s;
        }
        .search-input:focus {
            border-color: #667eea;
            outline: none;
        }
        .stock-detail-section {
            display: none;
        }
        .stock-detail-section.active {
            display: block;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">ğŸ“Š Aè‚¡è‚¡ç¥¨åˆ†æå¹³å°</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" id="nav-dashboard">æ€»è§ˆ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="nav-search">è‚¡ç¥¨æŸ¥è¯¢</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- è‚¡ç¥¨æŸ¥è¯¢éƒ¨åˆ† -->
        <div class="search-box">
            <h4 class="mb-3">ğŸ” è‚¡ç¥¨ä»£ç æŸ¥è¯¢</h4>
            <div class="row">
                <div class="col-md-8">
                    <input type="text" class="form-control search-input" id="stockCodeInput"
                           placeholder="è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ 000001ï¼‰" maxlength="6">
                </div>
                <div class="col-md-4">
                    <button class="btn btn-primary w-100" id="searchBtn" onclick="searchStock()">
                        æŸ¥è¯¢
                    </button>
                </div>
            </div>
            <div class="mt-2 text-muted small">
                æç¤ºï¼šè¯·è¾“å…¥6ä½è‚¡ç¥¨ä»£ç ï¼Œå¦‚ 000001ï¼ˆå¹³å®‰é“¶è¡Œï¼‰ã€600519ï¼ˆè´µå·èŒ…å°ï¼‰
            </div>
        </div>

        <!-- è‚¡ç¥¨æ¦œå•éƒ¨åˆ† -->
        <div class="row" id="rankingSection">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>èµ„é‡‘æµå…¥æ¦œå•</h2>
                    <div>
                        <select class="form-select d-inline-block w-auto me-2" id="days-select">
                            <option value="3">æœ€è¿‘3å¤©</option>
                            <option value="5" selected>æœ€è¿‘5å¤©</option>
                            <option value="10">æœ€è¿‘10å¤©</option>
                            <option value="20">æœ€è¿‘20å¤©</option>
                        </select>
                        <select class="form-select d-inline-block w-auto" id="topn-select">
                            <option value="5" selected>å‰5å</option>
                            <option value="10">å‰10å</option>
                            <option value="20">å‰20å</option>
                            <option value="30">å‰30å</option>
                        </select>
                    </div>
                </div>

                <!-- æ¦‚è§ˆæŒ‡æ ‡ -->
                <div class="row mb-4" id="metrics">
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="total-inflow">0</div>
                            <div class="metric-label">æ€»æµå…¥ï¼ˆä¸‡å…ƒï¼‰</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="avg-change">0%</div>
                            <div class="metric-label">å¹³å‡æ¶¨å¹…</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="stock-count">0</div>
                            <div class="metric-label">è‚¡ç¥¨æ•°é‡</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="metric-card">
                            <div class="metric-value" id="update-time">--:--:--</div>
                            <div class="metric-label">æ›´æ–°æ—¶é—´</div>
                        </div>
                    </div>
                </div>

                <!-- è‚¡ç¥¨åˆ—è¡¨ -->
                <div class="row" id="stock-list">
                    <div class="col-12 text-center">
                        <div class="loading">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å›¾è¡¨åŒºåŸŸ -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">èµ„é‡‘æµå…¥åˆ†å¸ƒ</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="fundFlowChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">æ¶¨è·Œåˆ†å¸ƒ</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="changeChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è‚¡ç¥¨è¯¦æƒ…éƒ¨åˆ† -->
        <div class="stock-detail-section" id="stockDetailSection">
            <div class="row">
                <div class="col-12">
                    <button class="btn btn-secondary mb-3" onclick="showRanking()">
                        â† è¿”å›æ¦œå•
                    </button>
                </div>
            </div>
            <div id="stockDetailContent">
                <div class="col-12 text-center">
                    <div class="loading">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="refresh-btn" id="refreshBtn">
        ğŸ”„
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let fundFlowChart = null;
        let changeChart = null;
        let stockData = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadStockData();
            initCharts();

            // äº‹ä»¶ç›‘å¬
            document.getElementById('days-select').addEventListener('change', loadStockData);
            document.getElementById('topn-select').addEventListener('change', loadStockData);
            document.getElementById('refreshBtn').addEventListener('click', loadStockData);
            document.getElementById('stockCodeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchStock();
                }
            });
        });

        // æœç´¢è‚¡ç¥¨
        async function searchStock() {
            const stockCode = document.getElementById('stockCodeInput').value.trim();

            if (!stockCode) {
                alert('è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ');
                return;
            }

            if (!/^\d{6}$/.test(stockCode)) {
                alert('è‚¡ç¥¨ä»£ç å¿…é¡»æ˜¯6ä½æ•°å­—');
                return;
            }

            showStockDetail(stockCode);
        }

        // æ˜¾ç¤ºè‚¡ç¥¨è¯¦æƒ…
        async function showStockDetail(stockCode) {
            // éšè—æ¦œå•ï¼Œæ˜¾ç¤ºè¯¦æƒ…
            document.getElementById('rankingSection').style.display = 'none';
            document.getElementById('stockDetailSection').classList.add('active');

            const detailContent = document.getElementById('stockDetailContent');
            detailContent.innerHTML = `
                <div class="col-12 text-center">
                    <div class="loading">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                    </div>
                </div>
            `;

            try {
                const response = await fetch(`/api/stock/details/${stockCode}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const details = result.data;
                    const changeClass = details.change_percent >= 0 ? 'positive' : 'negative';
                    const changeSymbol = details.change_percent >= 0 ? '+' : '';

                    detailContent.innerHTML = `
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">åŸºæœ¬ä¿¡æ¯</h5>
                                        <table class="table table-sm">
                                            <tr>
                                                <td>è‚¡ç¥¨ä»£ç </td>
                                                <td class="fw-bold">${details.code}</td>
                                            </tr>
                                            <tr>
                                                <td>è‚¡ç¥¨åç§°</td>
                                                <td class="fw-bold">${details.name}</td>
                                            </tr>
                                            <tr>
                                                <td>å½“å‰ä»·æ ¼</td>
                                                <td class="fw-bold">Â¥${details.current_price.toFixed(2)}</td>
                                            </tr>
                                            <tr>
                                                <td>æ¶¨è·Œå¹…</td>
                                                <td class="${changeClass} fw-bold">
                                                    ${changeSymbol}${details.change_percent.toFixed(2)}%
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>æˆäº¤é‡</td>
                                                <td>${(details.volume / 10000).toFixed(2)}ä¸‡</td>
                                            </tr>
                                            <tr>
                                                <td>æ¢æ‰‹ç‡</td>
                                                <td>${details.turnover_rate.toFixed(2)}%</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">èµ„é‡‘åˆ†æ</h5>
                                        <table class="table table-sm">
                                            <tr>
                                                <td>æ€»æµå…¥</td>
                                                <td class="text-success">Â¥${(details.fund_flow.total_inflow / 10000).toFixed(2)}ä¸‡</td>
                                            </tr>
                                            <tr>
                                                <td>ä¸»åŠ›å‡€æµå…¥</td>
                                                <td class="text-success">Â¥${(details.fund_flow.main_net_inflow / 10000).toFixed(2)}ä¸‡</td>
                                            </tr>
                                            <tr>
                                                <td>å¤§å•æµå…¥</td>
                                                <td class="text-success">Â¥${(details.fund_flow.large_order_inflow / 10000).toFixed(2)}ä¸‡</td>
                                            </tr>
                                            <tr>
                                                <td>ä¸­å•æµå…¥</td>
                                                <td class="text-success">Â¥${(details.fund_flow.medium_order_inflow / 10000).toFixed(2)}ä¸‡</td>
                                            </tr>
                                            <tr>
                                                <td>å°å•æµå…¥</td>
                                                <td class="text-success">Â¥${(details.fund_flow.small_order_inflow / 10000).toFixed(2)}ä¸‡</td>
                                            </tr>
                                            <tr>
                                                <td>æµå…¥å¾—åˆ†</td>
                                                <td class="fw-bold">${details.fund_flow_score}</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">è´¢åŠ¡æŒ‡æ ‡</h5>
                                        <table class="table table-sm">
                                            <tr>
                                                <td>å¸‚ç›ˆç‡</td>
                                                <td>${details.pe_ratio.toFixed(2)}</td>
                                            </tr>
                                            <tr>
                                                <td>è¥æ”¶å¢é•¿</td>
                                                <td class="${details.financial_indicators.revenue_growth >= 0 ? 'positive' : 'negative'}">
                                                    ${details.financial_indicators.revenue_growth >= 0 ? '+' : ''}${details.financial_indicators.revenue_growth}%
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>åˆ©æ¶¦å¢é•¿</td>
                                                <td class="${details.financial_indicators.profit_growth >= 0 ? 'positive' : 'negative'}">
                                                    ${details.financial_indicators.profit_growth >= 0 ? '+' : ''}${details.financial_indicators.profit_growth}%
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>ROE</td>
                                                <td>${details.financial_indicators.roe.toFixed(2)}%</td>
                                            </tr>
                                            <tr>
                                                <td>è´Ÿå€ºç‡</td>
                                                <td>${details.financial_indicators.debt_ratio.toFixed(2)}%</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">æŠ€æœ¯æŒ‡æ ‡</h5>
                                        <table class="table table-sm">
                                            <tr>
                                                <td>RSI</td>
                                                <td>${details.technical_indicators.rsi}</td>
                                            </tr>
                                            <tr>
                                                <td>MACD</td>
                                                <td class="${details.technical_indicators.macd >= 0 ? 'positive' : 'negative'}">
                                                    ${details.technical_indicators.macd >= 0 ? '+' : ''}${details.technical_indicators.macd}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>å¸ƒæ—å¸¦ä½ç½®</td>
                                                <td>${details.technical_indicators.bollinger_position.toFixed(2)}%</td>
                                            </tr>
                                            <tr>
                                                <td>é‡æ¯”</td>
                                                <td>${details.technical_indicators.volume_ratio.toFixed(2)}</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">æŠ•èµ„å»ºè®®</h5>
                                        <div class="alert alert-info">
                                            <strong>åˆ†æç»“è®ºï¼š</strong>${details.analysis}<br>
                                            <strong>æŠ•èµ„å»ºè®®ï¼š</strong><span class="fw-bold">${details.recommendation}</span>
                                        </div>
                                        <h6>è¡Œä¸šä¸æ¦‚å¿µ</h6>
                                        <p>
                                            <span class="badge bg-secondary">${details.industry}</span>
                                            ${details.concept.map(c => `<span class="badge bg-primary ms-1">${c}</span>`).join('')}
                                        </p>
                                        <h6 class="mt-3">æœ€æ–°åŠ¨æ€</h6>
                                        <ul class="list-unstyled">
                                            ${details.recent_news.map(news => `
                                                <li class="mb-2">
                                                    <a href="#" class="text-decoration-none">${news.title}</a>
                                                    <small class="text-muted">(${news.date} - ${news.source})</small>
                                                </li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    detailContent.innerHTML = `
                        <div class="col-12">
                            <div class="alert alert-danger">
                                æœªæ‰¾åˆ°è‚¡ç¥¨ ${stockCode} çš„è¯¦ç»†ä¿¡æ¯
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½è‚¡ç¥¨è¯¦æƒ…å¤±è´¥:', error);
                detailContent.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-danger">
                            åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•
                        </div>
                    </div>
                `;
            }
        }

        // æ˜¾ç¤ºæ¦œå•
        function showRanking() {
            document.getElementById('stockDetailSection').classList.remove('active');
            document.getElementById('rankingSection').style.display = 'block';
        }

        // åŠ è½½è‚¡ç¥¨æ•°æ®
        async function loadStockData() {
            const days = document.getElementById('days-select').value;
            const topn = document.getElementById('topn-select').value;

            try {
                const response = await fetch(`/api/stock/top_fund_flow?days=${days}&top_n=${topn}&include_details=true`);
                const result = await response.json();

                if (result.status === 'success') {
                    stockData = result.data;
                    renderStockList(stockData);
                    updateMetrics(stockData);
                    updateCharts(stockData);
                } else {
                    alert('åŠ è½½è‚¡ç¥¨æ•°æ®å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('åŠ è½½è‚¡ç¥¨æ•°æ®å¤±è´¥:', error);
                alert('åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }

        // æ¸²æŸ“è‚¡ç¥¨åˆ—è¡¨
        function renderStockList(stocks) {
            const container = document.getElementById('stock-list');

            if (stocks.length === 0) {
                container.innerHTML = '<div class="col-12 text-center"><p>æš‚æ— æ•°æ®</p></div>';
                return;
            }

            let html = '';
            stocks.forEach((stock, index) => {
                const rankClass = index < 3 ? `rank-${index + 1}` : 'rank-other';
                const changeClass = stock.change_percent >= 0 ? 'positive' : 'negative';
                const changeSymbol = stock.change_percent >= 0 ? '+' : '';

                html += `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card stock-card" onclick="showStockDetail('${stock.code}')">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="rank-badge ${rankClass} me-3">${index + 1}</div>
                                    <div>
                                        <h5 class="card-title mb-0">${stock.name}</h5>
                                        <small class="text-muted">${stock.code}</small>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-2">
                                            <small class="text-muted">ç°ä»·</small>
                                            <div class="h4 mb-0">Â¥${stock.current_price.toFixed(2)}</div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-2">
                                            <small class="text-muted">æ¶¨è·Œå¹…</small>
                                            <div class="h4 mb-0 ${changeClass}">${changeSymbol}${stock.change_percent.toFixed(2)}%</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted">èµ„é‡‘æµå…¥</small>
                                    <div class="h5 mb-0">Â¥${(stock.fund_flow.total_inflow / 10000).toFixed(2)}ä¸‡</div>
                                </div>
                                <div>
                                    <small class="text-muted">åˆ†æ</small>
                                    <div class="text-muted">${stock.analysis}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // æ›´æ–°æŒ‡æ ‡
        function updateMetrics(stocks) {
            if (stocks.length === 0) return;

            const totalInflow = stocks.reduce((sum, stock) => sum + (stock.fund_flow.total_inflow || 0), 0);
            const avgChange = stocks.reduce((sum, stock) => sum + stock.change_percent, 0) / stocks.length;

            document.getElementById('total-inflow').textContent = (totalInflow / 10000).toFixed(2);
            document.getElementById('avg-change').textContent = avgChange.toFixed(2) + '%';
            document.getElementById('stock-count').textContent = stocks.length;

            const now = new Date();
            document.getElementById('update-time').textContent = now.toLocaleTimeString();
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            const fundFlowCtx = document.getElementById('fundFlowChart').getContext('2d');
            const changeCtx = document.getElementById('changeChart').getContext('2d');

            fundFlowChart = new Chart(fundFlowCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'èµ„é‡‘æµå…¥ï¼ˆä¸‡å…ƒï¼‰',
                        data: [],
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            changeChart = new Chart(changeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ä¸Šæ¶¨', 'ä¸‹è·Œ'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['rgba(231, 76, 60, 0.8)', 'rgba(39, 174, 96, 0.8)'],
                        borderColor: ['rgba(231, 76, 60, 1)', 'rgba(39, 174, 96, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // æ›´æ–°å›¾è¡¨
        function updateCharts(stocks) {
            // æ›´æ–°èµ„é‡‘æµå…¥å›¾è¡¨
            fundFlowChart.data.labels = stocks.slice(0, 10).map(s => s.name);
            fundFlowChart.data.datasets[0].data = stocks.slice(0, 10).map(s => (s.fund_flow.total_inflow / 10000).toFixed(2));
            fundFlowChart.update();

            // æ›´æ–°æ¶¨è·Œåˆ†å¸ƒå›¾è¡¨
            const upCount = stocks.filter(s => s.change_percent >= 0).length;
            const downCount = stocks.filter(s => s.change_percent < 0).length;

            changeChart.data.datasets[0].data = [upCount, downCount];
            changeChart.update();
        }
    </script>
</body>
</html>
